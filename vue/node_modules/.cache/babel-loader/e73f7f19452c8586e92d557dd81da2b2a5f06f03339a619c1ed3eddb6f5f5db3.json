{"ast":null,"code":"import axios from 'axios';\nexport default {\n  name: 'StockDisplay',\n  data() {\n    return {\n      stockData: [],\n      loading: true,\n      error: null,\n      // 东方财富API代码映射\n      symbolsMap: {\n        '000001': '上证指数',\n        '399001': '深证成指',\n        '399006': '创业板指',\n        '000905': '中证500'\n      }\n    };\n  },\n  mounted() {\n    this.fetchStockData();\n    // 每30秒刷新一次数据\n    this.interval = setInterval(() => {\n      this.fetchStockData();\n    }, 30000);\n  },\n  beforeDestroy() {\n    if (this.interval) {\n      clearInterval(this.interval);\n    }\n  },\n  methods: {\n    async fetchStockData() {\n      this.loading = true;\n      this.error = null;\n      try {\n        // 构建东方财富API请求URL\n        const symbols = Object.keys(this.symbolsMap).join(',');\n        const response = await axios.get(`https://hq.sinajs.cn/list=${symbols.map(s => s.startsWith('0') ? 'sh' + s : 'sz' + s).join(',')}`);\n        if (!response.data) {\n          throw new Error('API返回数据为空');\n        }\n\n        // 解析返回的文本数据\n        const lines = response.data.split('\\n');\n        this.stockData = lines.filter(line => line.trim() !== '').map((line, index) => {\n          const symbol = Object.keys(this.symbolsMap)[index];\n          const name = this.symbolsMap[symbol];\n\n          // 解析数据格式: var hq_str_sh000001=\"上证指数,3316.1127,3309.8556,3323.1972,3307.0101,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0\";\n          const regex = /\"([^,]+),([^,]+),([^,]+),([^,]+),([^,]+),.*?\"/;\n          const matches = line.match(regex);\n          if (!matches || matches.length < 6) {\n            return {\n              name,\n              price: 'N/A',\n              change: 0,\n              changePercent: 'N/A'\n            };\n          }\n          const current = parseFloat(matches[2]);\n          const preClose = parseFloat(matches[3]);\n          const change = current - preClose;\n          const changePercent = (change / preClose * 100).toFixed(2);\n          return {\n            name,\n            price: current.toFixed(2),\n            change,\n            changePercent\n          };\n        });\n      } catch (error) {\n        console.error('获取股票数据失败:', error);\n        this.error = '获取股票数据失败，请稍后重试';\n      } finally {\n        this.loading = false;\n      }\n    }\n  }\n};","map":{"version":3,"names":["axios","name","data","stockData","loading","error","symbolsMap","mounted","fetchStockData","interval","setInterval","beforeDestroy","clearInterval","methods","symbols","Object","keys","join","response","get","map","s","startsWith","Error","lines","split","filter","line","trim","index","symbol","regex","matches","match","length","price","change","changePercent","current","parseFloat","preClose","toFixed","console"],"sources":["src/views/front/StockDisplay.vue"],"sourcesContent":["<template>\r\n  <div class=\"stock-display\">\r\n    <div class=\"top-border\"></div>\r\n    <div class=\"stock-data\">\r\n      <div v-if=\"loading\" class=\"loading\">\r\n        <i class=\"fa fa-spinner fa-spin\"></i> 加载中...\r\n      </div>\r\n      <div v-else-if=\"error\" class=\"error\">\r\n        <i class=\"fa fa-exclamation-triangle\"></i> {{ error }}\r\n      </div>\r\n      <div v-else>\r\n        <div v-for=\"(item, index) in stockData\" :key=\"index\" class=\"index-item\">\r\n          <span>{{ item.name }}</span>\r\n          <span :class=\"{ 'text-red': item.change > 0, 'text-green': item.change < 0 }\">\r\n            {{ item.price }} {{ item.change > 0 ? '▲' : '▼' }}\r\n          </span>\r\n          <span :class=\"{ 'text-red': item.change > 0, 'text-green': item.change < 0 }\">\r\n            {{ item.change > 0 ? '+' : '' }}{{ item.changePercent }}%\r\n          </span>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <div class=\"bottom-border\"></div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport axios from 'axios';\r\n\r\nexport default {\r\n  name: 'StockDisplay',\r\n  data() {\r\n    return {\r\n      stockData: [],\r\n      loading: true,\r\n      error: null,\r\n      // 东方财富API代码映射\r\n      symbolsMap: {\r\n        '000001': '上证指数',\r\n        '399001': '深证成指',\r\n        '399006': '创业板指',\r\n        '000905': '中证500'\r\n      }\r\n    };\r\n  },\r\n  mounted() {\r\n    this.fetchStockData();\r\n    // 每30秒刷新一次数据\r\n    this.interval = setInterval(() => {\r\n      this.fetchStockData();\r\n    }, 30000);\r\n  },\r\n  beforeDestroy() {\r\n    if (this.interval) {\r\n      clearInterval(this.interval);\r\n    }\r\n  },\r\n  methods: {\r\n    async fetchStockData() {\r\n      this.loading = true;\r\n      this.error = null;\r\n\r\n      try {\r\n        // 构建东方财富API请求URL\r\n        const symbols = Object.keys(this.symbolsMap).join(',');\r\n        const response = await axios.get(`https://hq.sinajs.cn/list=${symbols.map(s => s.startsWith('0') ? 'sh' + s : 'sz' + s).join(',')}`);\r\n\r\n        if (!response.data) {\r\n          throw new Error('API返回数据为空');\r\n        }\r\n\r\n        // 解析返回的文本数据\r\n        const lines = response.data.split('\\n');\r\n        this.stockData = lines\r\n            .filter(line => line.trim() !== '')\r\n            .map((line, index) => {\r\n              const symbol = Object.keys(this.symbolsMap)[index];\r\n              const name = this.symbolsMap[symbol];\r\n\r\n              // 解析数据格式: var hq_str_sh000001=\"上证指数,3316.1127,3309.8556,3323.1972,3307.0101,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0\";\r\n              const regex = /\"([^,]+),([^,]+),([^,]+),([^,]+),([^,]+),.*?\"/;\r\n              const matches = line.match(regex);\r\n\r\n              if (!matches || matches.length < 6) {\r\n                return {\r\n                  name,\r\n                  price: 'N/A',\r\n                  change: 0,\r\n                  changePercent: 'N/A'\r\n                };\r\n              }\r\n\r\n              const current = parseFloat(matches[2]);\r\n              const preClose = parseFloat(matches[3]);\r\n              const change = current - preClose;\r\n              const changePercent = (change / preClose * 100).toFixed(2);\r\n\r\n              return {\r\n                name,\r\n                price: current.toFixed(2),\r\n                change,\r\n                changePercent\r\n              };\r\n            });\r\n\r\n      } catch (error) {\r\n        console.error('获取股票数据失败:', error);\r\n        this.error = '获取股票数据失败，请稍后重试';\r\n      } finally {\r\n        this.loading = false;\r\n      }\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n\r\n<style scoped>\r\n.stock-display {\r\n  width: 100%;\r\n  margin-top: 37px;\r\n}\r\n\r\n.top-border,\r\n.bottom-border {\r\n  border-top: 2px solid black;\r\n  width: 100%;\r\n}\r\n\r\n.stock-data {\r\n  display: flex;\r\n  flex-direction: column;\r\n  padding: 10px 0;\r\n  font-weight: bold;\r\n}\r\n\r\n.index-item {\r\n  display: flex;\r\n  justify-content: space-around;\r\n  font-size: large;\r\n  margin-bottom: 15px;\r\n  font-weight: bold;\r\n}\r\n\r\n.loading, .error {\r\n  text-align: center;\r\n  padding: 20px;\r\n  color: #666;\r\n}\r\n\r\n.text-red {\r\n  color: red;\r\n}\r\n\r\n.text-green {\r\n  color: green;\r\n}\r\n</style>"],"mappings":"AA2BA,OAAAA,KAAA;AAEA;EACAC,IAAA;EACAC,KAAA;IACA;MACAC,SAAA;MACAC,OAAA;MACAC,KAAA;MACA;MACAC,UAAA;QACA;QACA;QACA;QACA;MACA;IACA;EACA;EACAC,QAAA;IACA,KAAAC,cAAA;IACA;IACA,KAAAC,QAAA,GAAAC,WAAA;MACA,KAAAF,cAAA;IACA;EACA;EACAG,cAAA;IACA,SAAAF,QAAA;MACAG,aAAA,MAAAH,QAAA;IACA;EACA;EACAI,OAAA;IACA,MAAAL,eAAA;MACA,KAAAJ,OAAA;MACA,KAAAC,KAAA;MAEA;QACA;QACA,MAAAS,OAAA,GAAAC,MAAA,CAAAC,IAAA,MAAAV,UAAA,EAAAW,IAAA;QACA,MAAAC,QAAA,SAAAlB,KAAA,CAAAmB,GAAA,8BAAAL,OAAA,CAAAM,GAAA,CAAAC,CAAA,IAAAA,CAAA,CAAAC,UAAA,eAAAD,CAAA,UAAAA,CAAA,EAAAJ,IAAA;QAEA,KAAAC,QAAA,CAAAhB,IAAA;UACA,UAAAqB,KAAA;QACA;;QAEA;QACA,MAAAC,KAAA,GAAAN,QAAA,CAAAhB,IAAA,CAAAuB,KAAA;QACA,KAAAtB,SAAA,GAAAqB,KAAA,CACAE,MAAA,CAAAC,IAAA,IAAAA,IAAA,CAAAC,IAAA,WACAR,GAAA,EAAAO,IAAA,EAAAE,KAAA;UACA,MAAAC,MAAA,GAAAf,MAAA,CAAAC,IAAA,MAAAV,UAAA,EAAAuB,KAAA;UACA,MAAA5B,IAAA,QAAAK,UAAA,CAAAwB,MAAA;;UAEA;UACA,MAAAC,KAAA;UACA,MAAAC,OAAA,GAAAL,IAAA,CAAAM,KAAA,CAAAF,KAAA;UAEA,KAAAC,OAAA,IAAAA,OAAA,CAAAE,MAAA;YACA;cACAjC,IAAA;cACAkC,KAAA;cACAC,MAAA;cACAC,aAAA;YACA;UACA;UAEA,MAAAC,OAAA,GAAAC,UAAA,CAAAP,OAAA;UACA,MAAAQ,QAAA,GAAAD,UAAA,CAAAP,OAAA;UACA,MAAAI,MAAA,GAAAE,OAAA,GAAAE,QAAA;UACA,MAAAH,aAAA,IAAAD,MAAA,GAAAI,QAAA,QAAAC,OAAA;UAEA;YACAxC,IAAA;YACAkC,KAAA,EAAAG,OAAA,CAAAG,OAAA;YACAL,MAAA;YACAC;UACA;QACA;MAEA,SAAAhC,KAAA;QACAqC,OAAA,CAAArC,KAAA,cAAAA,KAAA;QACA,KAAAA,KAAA;MACA;QACA,KAAAD,OAAA;MACA;IACA;EACA;AACA"},"metadata":{},"sourceType":"module","externalDependencies":[]}